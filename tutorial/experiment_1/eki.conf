################################################################################
#                    ENSEMBLE KALMAN INVERSION CONFIGURATION
################################################################################
# This file configures the Ensemble Kalman Inversion (EKI) algorithm for
# atmospheric source term estimation.
#
# EKI is an inverse modeling technique that optimizes emission time series
# by assimilating receptor observations through ensemble-based covariance.
#
# Units are specified in parentheses for each parameter.
# Boolean flags: On/Off
################################################################################

# ==============================================================================
# TEMPORAL SETTINGS
# ==============================================================================
# Defines the time resolution for emission time series

# Time interval between emission values (float)
# This determines how often emission rates can change
# Finer intervals = more degrees of freedom = harder inverse problem
EKI_TIME_INTERVAL: 15.0

# Unit for time interval
# Options: seconds, minutes, hours
# Example: 15.0 minutes = emit a value every 15 minutes
EKI_TIME_UNIT: minutes

# ==============================================================================
# EMISSION TIME SERIES CONFIGURATION
# ==============================================================================
# ⚠️ MOVED TO source.conf ⚠️
#
# The emission configuration (TRUE_EMISSION_SERIES, PRIOR_EMISSION_MODE,
# PRIOR_EMISSION_CONSTANT) has been moved to source.conf for better organization.
#
# Please edit source.conf to configure:
#   - TRUE_EMISSION_SERIES: Reference emission time series
#   - PRIOR_EMISSION_MODE: "constant" or "series"
#   - PRIOR_EMISSION_CONSTANT: Initial guess for constant mode
#
# This section is kept as a placeholder to maintain backward compatibility.
# The parser will ignore any emission-related settings in this file.

# ==============================================================================
# ENSEMBLE KALMAN INVERSION ALGORITHM
# ==============================================================================
# Controls the EKI optimization process

# Number of ensemble members
# Each member represents a perturbed version of the state vector
# More members = better covariance estimation = better convergence
# But also more computational cost (linear scaling)
#
# Recommended values:
#   - Minimum: 50 (for stable covariance)
#   - Typical: 100-200 (good balance)
#   - High accuracy: 500-1000 (expensive)
#
# Rule: ensemble_size >= 2 × num_state_variables
# where num_state_variables = number of emission timesteps
# Example: 24 timesteps (6-hour simulation, 15-min intervals) → minimum 48 members
# Recommended: 50-100 for robust estimation
EKI_ENSEMBLE_SIZE: 100

# Observation noise level (fraction)
# Artificial noise added to synthetic observations to represent uncertainty
# This prevents overfitting and stabilizes the inversion
#
# Physical interpretation:
#   0.0 = perfect observations (no uncertainty)
#   0.1 = 10% relative error (typical for gamma dose rate)
#   0.5 = 50% relative error (very uncertain measurements)
#
# Recommended: 0.05 - 0.20 for realistic scenarios
EKI_NOISE_LEVEL: 0.2

# Maximum number of EKI iterations
# Each iteration refines the ensemble by assimilating observations
# More iterations = potentially better convergence, but diminishing returns
#
# Typical behavior:
#   - Well-posed problems: converge in 3-10 iterations
#   - Ill-posed problems: may need 20-50 iterations
#   - Beyond 100 iterations usually indicates fundamental issues
#
# Recommended: Start with 5-10, increase if not converged
EKI_ITERATION: 3

# --------------------
# Advanced EKI Options
# --------------------
# These modify the basic EnKF algorithm for special cases

# Ensemble perturbation at each iteration
# On = Add random noise to ensemble (helps exploration)
# Off = No perturbation (standard EKI)
# Recommended: Off (unless dealing with model error)
EKI_PERTURB_OPTION: Off

# Adaptive step size control
# On = Automatically adjust Kalman gain for stability
# Off = Use standard fixed gain
# Use when: Inversion is diverging or oscillating
EKI_ADAPTIVE: Off

EKI_LOCALIZED: Off
# ⚠️ THIS PARAMETER IS IGNORED IN v1.0 - FEATURE DISABLED
#
# Covariance localization using Gaspari-Cohn function
# STATUS: Disabled for v1.0 release
#
# Technical details (for reference only):
# - Reduces spurious correlations in small ensembles
# - Localization_radius: Distance cutoff in degrees
# - When re-enabled, use radius = 0.5-2.0 degrees for regional problems

# Tikhonov regularization
# On = Add penalty term to prevent overfitting
# Off = No regularization
# Use when: Problem is ill-posed or underdetermined
EKI_REGULARIZATION: Off

# Regularization strength (only used if REGULARIZATION = On)
# Larger values = stronger smoothing = less overfitting
# Typical range: 0.1 - 0.99
# 0.9 = strong regularization (prefer smooth solutions)
EKI_RENKF_LAMBDA: 0.5

# Ensemble inflation factor
# Prevents ensemble collapse by inflating the spread around the mean
# 1.0 = no inflation (standard EnKF)
# 1.1-1.5 = mild inflation for stable problems
# 2.0-5.0 = strong inflation for extreme initial conditions
# Use when: Initial values far from truth, ensemble collapse detected
EKI_INFLATION: 1.0

# ==============================================================================
# DEBUGGING
# ==============================================================================

# Memory Doctor Mode (IPC debugging tool)
# On = Log all data transfers between C++ and Python to /tmp/eki_debug/
# Off = Normal operation (no debug logging)
#
# Use when:
#   - Suspecting data corruption in shared memory
#   - Ensemble values look wrong
#   - Python crashes with cryptic errors
#
# Performance impact: Moderate (lots of file I/O)
# Recommended: Off (enable only when debugging IPC issues)
MEMORY_DOCTOR_MODE: Off

################################################################################
# End of eki.conf
################################################################################
